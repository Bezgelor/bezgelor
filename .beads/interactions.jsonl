{"id":"bezgelor-09q","title":"Create CurrencyTransaction schema","description":"Create the CurrencyTransaction schema for logging all currency changes.\n\nFiles:\n- Create: apps/bezgelor_db/lib/bezgelor_db/schema/currency_transaction.ex\n- Test: apps/bezgelor_db/test/schema/currency_transaction_test.exs\n\nSchema fields:\n- character_id, account_id (references)\n- currency_type (enum: gold, elder_gems, renown, prestige, glory, crafting_vouchers, war_coins, shade_silver, protostar_promissory_notes)\n- amount (integer, can be negative)\n- balance_after (integer)\n- source (enum: quest_reward, vendor_buy, vendor_sell, loot_pickup, mail_received, mail_sent, trade_received, trade_sent, auction_sold, auction_purchased, auction_fee, repair_cost, taxi_fee, tradeskill_cost, guild_deposit, guild_withdraw, housing_purchase, admin_grant, admin_remove, other)\n- source_id (optional integer)\n- metadata (map)\n- session_id (optional string)\n- inserted_at (no updated_at - immutable log)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T00:53:12.428677-08:00","updated_at":"2025-12-21T00:53:12.428677-08:00","labels":["economy","schema"]}
{"id":"bezgelor-2mq","title":"Deprecate Inventory currency functions","description":"Mark Inventory currency functions as deprecated and delegate to Economy.\n\nFiles:\n- Modify: apps/bezgelor_db/lib/bezgelor_db/inventory.ex\n\nChanges:\n- Add @deprecated attribute to modify_currency/3, add_currency/3, spend_currency/3\n- Log warnings when deprecated functions are called\n- Delegate to Economy.modify_currency with :other source\n- Run full test suite to verify (expect deprecation warnings)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T00:54:24.774628-08:00","updated_at":"2025-12-21T00:54:24.774628-08:00","labels":["deprecation","economy"],"dependencies":[{"issue_id":"bezgelor-2mq","depends_on_id":"bezgelor-lye","type":"blocks","created_at":"2025-12-21T00:56:09.971626-08:00","created_by":"daemon"},{"issue_id":"bezgelor-2mq","depends_on_id":"bezgelor-46z","type":"blocks","created_at":"2025-12-21T00:56:10.164734-08:00","created_by":"daemon"},{"issue_id":"bezgelor-2mq","depends_on_id":"bezgelor-q4p","type":"blocks","created_at":"2025-12-21T00:56:10.339815-08:00","created_by":"daemon"},{"issue_id":"bezgelor-2mq","depends_on_id":"bezgelor-5hj","type":"blocks","created_at":"2025-12-21T00:56:10.707668-08:00","created_by":"daemon"},{"issue_id":"bezgelor-2mq","depends_on_id":"bezgelor-e3e","type":"blocks","created_at":"2025-12-21T00:56:10.92574-08:00","created_by":"daemon"}]}
{"id":"bezgelor-46z","title":"Migrate vendor handler to Economy","description":"Update vendor buy handler to use Economy.modify_currency.\n\nFiles:\n- Modify: apps/bezgelor_protocol/lib/bezgelor_protocol/handler/vendor_handler.ex\n\nChanges:\n- Add alias BezgelorDb.Economy\n- Replace Inventory.spend_currency with Economy.modify_currency using :vendor_buy source\n- Update refund logic to use Economy.modify_currency with refund metadata","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T00:53:52.830744-08:00","updated_at":"2025-12-21T00:53:52.830744-08:00","labels":["economy","migration","vendor"],"dependencies":[{"issue_id":"bezgelor-46z","depends_on_id":"bezgelor-u76","type":"blocks","created_at":"2025-12-21T00:55:30.528701-08:00","created_by":"daemon"}]}
{"id":"bezgelor-5hj","title":"Migrate portal character detail to Economy","description":"Update portal admin character detail page to use Economy.modify_currency.\n\nFiles:\n- Modify: apps/bezgelor_portal/lib/bezgelor_portal_web/live/admin/character_detail_live.ex\n\nChanges:\n- Add alias BezgelorDb.Economy\n- Replace Inventory.modify_currency with Economy.modify_currency\n- Use :admin_grant source with admin_id in metadata","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T00:54:23.679324-08:00","updated_at":"2025-12-21T00:54:23.679324-08:00","labels":["economy","migration","portal"],"dependencies":[{"issue_id":"bezgelor-5hj","depends_on_id":"bezgelor-u76","type":"blocks","created_at":"2025-12-21T00:55:30.887585-08:00","created_by":"daemon"}]}
{"id":"bezgelor-5ma","title":"Add economy telemetry metrics to Portal","description":"Add economy-related telemetry metrics to Portal.\n\nFiles:\n- Modify: apps/bezgelor_portal/lib/bezgelor_portal_web/telemetry.ex\n\nMetrics:\n- counter: bezgelor.economy.transaction.count (tags: currency_type, source)\n- sum: bezgelor.economy.transaction.amount (tags: currency_type, source)\n- last_value: bezgelor.economy.circulation.total (tags: currency_type)\n- counter: bezgelor.economy.alert.triggered (tags: type)","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T00:53:52.256102-08:00","updated_at":"2025-12-21T00:53:52.256102-08:00","labels":["economy","portal","telemetry"]}
{"id":"bezgelor-5n1","title":"Final verification of economy implementation","description":"Final end-to-end verification of the economy implementation.\n\nSteps:\n1. Start the server with mix phx.server\n2. Navigate to http://localhost:4000/admin/economy\n3. Verify dashboard loads with real data\n4. Send a gift via gift tab\n5. Verify transaction appears in live feed\n6. Commit any final fixes\n\nVerify:\n- Real-time updates work\n- Alert notifications display\n- Gift tab creates transactions","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T00:54:25.453611-08:00","updated_at":"2025-12-21T00:54:25.453611-08:00","labels":["economy","verification"],"dependencies":[{"issue_id":"bezgelor-5n1","depends_on_id":"bezgelor-66n","type":"blocks","created_at":"2025-12-21T00:56:17.569226-08:00","created_by":"daemon"},{"issue_id":"bezgelor-5n1","depends_on_id":"bezgelor-7hp","type":"blocks","created_at":"2025-12-21T00:56:17.847905-08:00","created_by":"daemon"}]}
{"id":"bezgelor-66n","title":"Update economy dashboard with real data","description":"Wire up the economy dashboard with real data and PubSub subscriptions.\n\nFiles:\n- Modify: apps/bezgelor_portal/lib/bezgelor_portal_web/live/admin/economy_live.ex\n\nChanges:\n- Subscribe to economy:updates and economy:alerts PubSub topics\n- Load real stats via Economy context in mount/3\n- Add handle_info for PubSub messages\n- Update overview_tab to display real data:\n  - Total gold in circulation\n  - Daily gold generated/removed\n  - Top gold holders table\n  - Gold flow by source table\n  - Live transaction feed","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T00:54:24.387091-08:00","updated_at":"2025-12-21T00:54:24.387091-08:00","labels":["economy","liveview","portal"],"dependencies":[{"issue_id":"bezgelor-66n","depends_on_id":"bezgelor-db7","type":"blocks","created_at":"2025-12-21T00:55:33.582202-08:00","created_by":"daemon"},{"issue_id":"bezgelor-66n","depends_on_id":"bezgelor-bqm","type":"blocks","created_at":"2025-12-21T00:55:33.751451-08:00","created_by":"daemon"}]}
{"id":"bezgelor-6ba","title":"Loot drop telemetry","description":"Add telemetry for item drops: creature loot, chest loot, item rarity, zone, drop rates for economy balance analysis.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T02:53:54.381231-08:00","updated_at":"2025-12-21T02:53:54.381231-08:00","dependencies":[{"issue_id":"bezgelor-6ba","depends_on_id":"bezgelor-rmg","type":"parent-child","created_at":"2025-12-21T02:54:54.840788-08:00","created_by":"daemon"}]}
{"id":"bezgelor-7d1","title":"Create economy tables migration","description":"Create database migration for economy tables.\n\nFiles:\n- Create: apps/bezgelor_db/priv/repo/migrations/20251221000000_create_economy_tables.exs\n\nTables:\n1. currency_transactions\n   - character_id, account_id references\n   - currency_type, amount, balance_after, source, source_id, metadata, session_id\n   - inserted_at only (immutable log)\n   - Indexes: (character_id, inserted_at), (source, inserted_at), (inserted_at)\n\n2. economy_alerts\n   - character_id reference\n   - type, details, status, resolved_by_id, resolution_notes\n   - timestamps\n   - Indexes: status, character_id, (type, inserted_at)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T00:53:14.265576-08:00","updated_at":"2025-12-21T00:53:14.265576-08:00","labels":["economy","migration"],"dependencies":[{"issue_id":"bezgelor-7d1","depends_on_id":"bezgelor-09q","type":"blocks","created_at":"2025-12-21T00:55:00.756498-08:00","created_by":"daemon"},{"issue_id":"bezgelor-7d1","depends_on_id":"bezgelor-qjn","type":"blocks","created_at":"2025-12-21T00:55:00.948745-08:00","created_by":"daemon"}]}
{"id":"bezgelor-7hp","title":"Run full test suite for economy integration","description":"Run the full test suite and fix any issues from the economy integration.\n\nSteps:\n1. Run mix test\n2. Fix any failures\n3. Commit fixes if needed\n\nExpected: All tests pass (with deprecation warnings from Inventory functions)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T00:54:25.110907-08:00","updated_at":"2025-12-21T00:54:25.110907-08:00","labels":["economy","testing"],"dependencies":[{"issue_id":"bezgelor-7hp","depends_on_id":"bezgelor-2mq","type":"blocks","created_at":"2025-12-21T00:56:14.312297-08:00","created_by":"daemon"}]}
{"id":"bezgelor-835","title":"Crafting telemetry","description":"Add telemetry for crafting: materials consumed, items crafted, tradeskill used, success/failure rates, material sinks.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T02:53:54.740157-08:00","updated_at":"2025-12-21T02:53:54.740157-08:00","dependencies":[{"issue_id":"bezgelor-835","depends_on_id":"bezgelor-rmg","type":"parent-child","created_at":"2025-12-21T02:54:54.982554-08:00","created_by":"daemon"}]}
{"id":"bezgelor-aep","title":"Create Economy.Alerts GenServer","description":"Create GenServer for threshold detection and Discord webhook integration.\n\nFiles:\n- Create: apps/bezgelor_world/lib/bezgelor_world/economy/alerts.ex\n- Test: apps/bezgelor_world/test/economy/alerts_test.exs\n\nThresholds (configurable):\n- gold_gain_per_hour: 100,000 default\n- gold_balance_max: 1,000,000 default  \n- transactions_per_minute: 60 default\n\nFunctionality:\n- Tracks hourly gains per character\n- Tracks transaction rate per minute\n- Periodic balance checks (every minute)\n- Triggers alerts on threshold violations\n- Logs to database, broadcasts via PubSub, sends Discord webhooks\n\nDiscord webhook configured via ECONOMY_DISCORD_WEBHOOK env var.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T00:53:17.077862-08:00","updated_at":"2025-12-21T00:53:17.077862-08:00","labels":["discord","economy","genserver"],"dependencies":[{"issue_id":"bezgelor-aep","depends_on_id":"bezgelor-u76","type":"blocks","created_at":"2025-12-21T00:55:06.279249-08:00","created_by":"daemon"}]}
{"id":"bezgelor-bqm","title":"Add Economy GenServers to supervisor","description":"Add Economy.Telemetry and Economy.Alerts to the BezgelorWorld application supervisor.\n\nFiles:\n- Modify: apps/bezgelor_world/lib/bezgelor_world/application.ex\n\nAdd to base_children list:\n- BezgelorWorld.Economy.Telemetry\n- BezgelorWorld.Economy.Alerts\n\nVerify application starts without errors.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T00:53:51.662619-08:00","updated_at":"2025-12-21T00:53:51.662619-08:00","labels":["economy","supervisor"],"dependencies":[{"issue_id":"bezgelor-bqm","depends_on_id":"bezgelor-db7","type":"blocks","created_at":"2025-12-21T00:55:08.144369-08:00","created_by":"daemon"},{"issue_id":"bezgelor-bqm","depends_on_id":"bezgelor-aep","type":"blocks","created_at":"2025-12-21T00:55:08.308244-08:00","created_by":"daemon"}]}
{"id":"bezgelor-c2e","title":"Item repair telemetry","description":"Add telemetry for item repairs: repair costs, durability restored, gold sink tracking.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-21T02:53:55.025782-08:00","updated_at":"2025-12-21T02:53:55.025782-08:00","dependencies":[{"issue_id":"bezgelor-c2e","depends_on_id":"bezgelor-rmg","type":"parent-child","created_at":"2025-12-21T02:54:55.128651-08:00","created_by":"daemon"}]}
{"id":"bezgelor-cu2","title":"Currency transaction telemetry","description":"Add telemetry events for currency gains/losses: gold earned from quests, loot, sales; gold spent on vendors, repairs, AH fees. Track source, amount, and character balance.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T02:53:52.750767-08:00","updated_at":"2025-12-21T02:53:52.750767-08:00","dependencies":[{"issue_id":"bezgelor-cu2","depends_on_id":"bezgelor-rmg","type":"parent-child","created_at":"2025-12-21T02:54:54.07001-08:00","created_by":"daemon"}]}
{"id":"bezgelor-db7","title":"Create Economy.Telemetry GenServer","description":"Create GenServer for buffering telemetry events and broadcasting to dashboard.\n\nFiles:\n- Create: apps/bezgelor_world/lib/bezgelor_world/economy/telemetry.ex\n- Test: apps/bezgelor_world/test/economy/telemetry_test.exs\n\nFunctionality:\n- Attaches to [:bezgelor, :economy, :transaction] telemetry events\n- Buffers transactions in memory\n- Broadcasts aggregated summaries every 5 seconds via Phoenix PubSub\n- Topic: economy:updates\n\nAggregation includes:\n- Transaction count\n- Breakdown by currency type\n- Breakdown by source type\n- Recent transactions (last 10)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T00:53:16.257678-08:00","updated_at":"2025-12-21T00:53:16.257678-08:00","labels":["economy","genserver"],"dependencies":[{"issue_id":"bezgelor-db7","depends_on_id":"bezgelor-u76","type":"blocks","created_at":"2025-12-21T00:55:06.109573-08:00","created_by":"daemon"}]}
{"id":"bezgelor-e3e","title":"Migrate economy live gift tab to Economy","description":"Update portal economy live gift tab to use Economy.modify_currency.\n\nFiles:\n- Modify: apps/bezgelor_portal/lib/bezgelor_portal_web/live/admin/economy_live.ex\n\nChanges:\n- Add Economy to alias\n- Update send_gift/5 currency case to use Economy.modify_currency\n- Include reason and admin_id in metadata\n- Handle :insufficient_funds and :invalid_currency errors","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T00:54:24.024812-08:00","updated_at":"2025-12-21T00:54:24.024812-08:00","labels":["economy","migration","portal"],"dependencies":[{"issue_id":"bezgelor-e3e","depends_on_id":"bezgelor-u76","type":"blocks","created_at":"2025-12-21T00:55:31.073338-08:00","created_by":"daemon"}]}
{"id":"bezgelor-ejm","title":"Auction house telemetry","description":"Add telemetry for auction house: listings created, items sold, items expired, buyouts, bids. Track prices, fees, and market activity.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T02:53:53.444201-08:00","updated_at":"2025-12-21T02:53:53.444201-08:00","dependencies":[{"issue_id":"bezgelor-ejm","depends_on_id":"bezgelor-rmg","type":"parent-child","created_at":"2025-12-21T02:54:54.363256-08:00","created_by":"daemon"}]}
{"id":"bezgelor-lye","title":"Migrate quest reward handler to Economy","description":"Update quest reward handler to use Economy.modify_currency instead of direct Inventory calls.\n\nFiles:\n- Modify: apps/bezgelor_world/lib/bezgelor_world/quest/reward_handler.ex\n\nChanges:\n- Add alias BezgelorDb.Economy\n- Update add_currency/3 to use Economy.modify_currency with :quest_reward source\n- Update grant_currency/3 to pass quest_id as source_id\n- Run quest tests to verify","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T00:53:52.544041-08:00","updated_at":"2025-12-21T00:53:52.544041-08:00","labels":["economy","migration","quest"],"dependencies":[{"issue_id":"bezgelor-lye","depends_on_id":"bezgelor-u76","type":"blocks","created_at":"2025-12-21T00:55:30.369936-08:00","created_by":"daemon"}]}
{"id":"bezgelor-n8q","title":"Add economy configuration","description":"Add economy tracking configuration to config/config.exs.\n\nFiles:\n- Modify: config/config.exs\n\nConfiguration keys:\n- gold_gain_per_hour_threshold: 100_000\n- gold_balance_max_threshold: 1_000_000\n- transactions_per_minute_threshold: 60\n- discord_webhook_url: from ECONOMY_DISCORD_WEBHOOK env var\n- dashboard_update_interval_ms: 5_000","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T00:53:51.952735-08:00","updated_at":"2025-12-21T00:53:51.952735-08:00","labels":["config","economy"],"dependencies":[{"issue_id":"bezgelor-n8q","depends_on_id":"bezgelor-aep","type":"blocks","created_at":"2025-12-21T00:55:11.063661-08:00","created_by":"daemon"}]}
{"id":"bezgelor-q4p","title":"Migrate vendor sell handler to Economy","description":"Update vendor sell handler to use Economy.modify_currency.\n\nFiles:\n- Modify: apps/bezgelor_protocol/lib/bezgelor_protocol/handler/vendor_sell_handler.ex\n\nChanges:\n- Add alias BezgelorDb.Economy\n- Replace Inventory.add_currency with Economy.modify_currency using :vendor_sell source\n- Include item_id and quantity in metadata","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T00:53:53.118896-08:00","updated_at":"2025-12-21T00:53:53.118896-08:00","labels":["economy","migration","vendor"],"dependencies":[{"issue_id":"bezgelor-q4p","depends_on_id":"bezgelor-u76","type":"blocks","created_at":"2025-12-21T00:55:30.697699-08:00","created_by":"daemon"}]}
{"id":"bezgelor-qjn","title":"Create EconomyAlert schema","description":"Create the EconomyAlert schema for tracking threshold violations and suspicious activity.\n\nFiles:\n- Create: apps/bezgelor_db/lib/bezgelor_db/schema/economy_alert.ex\n- Test: apps/bezgelor_db/test/schema/economy_alert_test.exs\n\nSchema fields:\n- character_id (reference)\n- type (enum: excessive_gold_gain, high_balance, suspicious_pattern, rapid_transactions)\n- details (map)\n- status (enum: open, investigating, resolved, dismissed)\n- resolved_by_id (integer)\n- resolution_notes (string)\n- timestamps\n\nIncludes resolve_changeset/4 for updating alert status.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T00:53:13.414102-08:00","updated_at":"2025-12-21T00:53:13.414102-08:00","labels":["economy","schema"],"dependencies":[{"issue_id":"bezgelor-qjn","depends_on_id":"bezgelor-09q","type":"blocks","created_at":"2025-12-21T00:54:56.406074-08:00","created_by":"daemon"}]}
{"id":"bezgelor-rmg","title":"Economy Telemetry Integration","description":"Add comprehensive telemetry instrumentation across all economy-related systems to enable real-time monitoring, analytics, and debugging of in-game economic activity via LiveDashboard.","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-21T02:53:34.123857-08:00","updated_at":"2025-12-21T02:53:34.123857-08:00"}
{"id":"bezgelor-tlg","title":"Vendor transaction telemetry","description":"Add telemetry for NPC vendor interactions: items purchased, items sold, prices, vendor ID. Enables economy flow analysis.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T02:53:53.122857-08:00","updated_at":"2025-12-21T02:53:53.122857-08:00","dependencies":[{"issue_id":"bezgelor-tlg","depends_on_id":"bezgelor-rmg","type":"parent-child","created_at":"2025-12-21T02:54:54.217422-08:00","created_by":"daemon"}]}
{"id":"bezgelor-u76","title":"Create Economy context module","description":"Create the Economy context module as the single entry point for all currency changes.\n\nFiles:\n- Create: apps/bezgelor_db/lib/bezgelor_db/economy.ex\n- Test: apps/bezgelor_db/test/economy_test.exs\n\nCore API:\n- modify_currency/5: Atomic currency modification with transaction logging\n- list_transactions/1: Query transactions with filters\n- count_transactions/1: Count matching transactions\n\nAnalytics:\n- total_currency_in_circulation/1: Sum all character balances\n- sum_transactions/2: Sum transactions by currency type with date range\n- top_currency_holders/2: Get characters with highest balances\n- transactions_by_source/1: Breakdown by source type\n\nAlert Management:\n- create_alert/1, list_alerts/1, resolve_alert/4\n- open_alert_count/0\n\nEmits telemetry events for real-time dashboard updates.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-21T00:53:15.199939-08:00","updated_at":"2025-12-21T00:53:15.199939-08:00","labels":["context","economy"],"dependencies":[{"issue_id":"bezgelor-u76","depends_on_id":"bezgelor-7d1","type":"blocks","created_at":"2025-12-21T00:55:03.946501-08:00","created_by":"daemon"}]}
{"id":"bezgelor-uvy","title":"Player trade telemetry","description":"Add telemetry for player-to-player trades: items exchanged, currency exchanged, trade completions/cancellations.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T02:53:54.077206-08:00","updated_at":"2025-12-21T02:53:54.077206-08:00","dependencies":[{"issue_id":"bezgelor-uvy","depends_on_id":"bezgelor-rmg","type":"parent-child","created_at":"2025-12-21T02:54:54.691177-08:00","created_by":"daemon"}]}
{"id":"bezgelor-wgl","title":"Mail system telemetry","description":"Add telemetry for mail with economic impact: currency attachments sent/received, item attachments, COD transactions.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-21T02:53:53.767784-08:00","updated_at":"2025-12-21T02:53:53.767784-08:00","dependencies":[{"issue_id":"bezgelor-wgl","depends_on_id":"bezgelor-rmg","type":"parent-child","created_at":"2025-12-21T02:54:54.526129-08:00","created_by":"daemon"}]}
